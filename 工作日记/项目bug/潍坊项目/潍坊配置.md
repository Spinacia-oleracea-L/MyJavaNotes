# VMware

激活码：MC60H-DWHD5-H80U9-6V85M-8280D

![image-20240923161801480](.\潍坊配置.assets\image-20240923161801480.png)

# 环境部署

## jdk

1. 解压

   * ```bash
     mkdir -p /usr/local/java
     tar -zxvf jdk-8u191-linux-x64.tar.gz -C /usr/local/java
     ```

2. 修改 **/etc/profile** 文件

   * ```bash
     vim /etc/profile
     ```

   * ```bash
     export JAVA_HOME=/usr/local/java/jdk1.8.0_191
     export CLASSPATH=$JAVA_HOME/lib/
     export PATH=$PATH:$JAVA_HOME/bin
     export PATH JAVA_HOME CLASSPATH
     ```

3. 重新加载profile文件

   * ```bash
     source /etc/profile
     ```

4. 查看当前配置完成的jdk版本

   * ```bash
     java -version
     ```

## mysql

1. 解压

   * ```bash
     mkdir -p /usr/local/mysql
     tar xvf mysql-8.0.17-linux-glibc2.12-x86_64.tar.xz -C /usr/local/mysql
     ```

2. 重命名

   * ```bash
     # 要在/usr/local/mysql目录下执行
     mv mysql-8.0.17-linux-glibc2.12-x86_64 mysql8
     ```

3. 配置文件**/etc/my.cnf**

   * ```bash
     vi /etc/my.cnf
     ```

   * ```bash
     [client]
     port=3306
     socket=/var/lib/mysql8/mysql.sock
      
     [mysqld]
     port=3306
     user=mysql
     socket=/var/lib/mysql8/mysql.sock
     basedir=/usr/local/mysql/mysql8
     datadir=/usr/local/mysql/mysql8/data
     lower-case-table-names=1
     
     ```

4. 创建mysql组与用户

   * ```bash
     groupadd mysql
     useradd -g mysql mysql
     ```

5. 初始化mysql

   * ```bash
     # 执行完毕后一定记录密码
     /usr/local/mysql/mysql8/bin/mysqld --initialize --lower-case-table-names=1 --user=mysql --basedir=/usr/local/mysql/mysql8/ --datadir=/usr/local/mysql/mysql8/data/
     ```

   * ```bash
     [root@localhost ~]# /usr/local/mysql/mysql8/bin/mysqld --initialize --lower-case-table-names=1 --user=mysql --basedir=/usr/local/mysql/mysql8/ --datadir=/usr/local/mysql/mysql8/data/
     2024-09-24T02:38:37.483980Z 0 [Warning] [MY-011070] [Server] 'Disabling symbolic links using --skip-symbolic-links (or equivalent) is the default. Consider not using this option as it' is deprecated and will be removed in a future release.
     2024-09-24T02:38:37.484121Z 0 [System] [MY-013169] [Server] /usr/local/mysql/mysql8/bin/mysqld (mysqld 8.0.17) initializing of server in progress as process 10628
     2024-09-24T02:38:39.789459Z 5 [Note] [MY-010454] [Server] A temporary password is generated for root@localhost: k2d)g1OyvgZX
     2024-09-24T02:38:40.508560Z 0 [System] [MY-013170] [Server] /usr/local/mysql/mysql8/bin/mysqld (mysqld 8.0.17) initializing of server has completed
     ```

6. 创建sock文件夹与命令链接

   * ```bash
     mkdir -p /var/lib/mysql8
     chown -R mysql:mysql /var/lib/mysql8
     ln -s /usr/local/mysql/mysql8/bin/mysql /usr/bin
     ```

7. 启动服务

   * ```bash
     /usr/local/mysql/mysql8/support-files/mysql.server start
     ```

   * ```bash
     # 使用初始密码登录
     mysql -u root -p
     ```

   * ```bash
     # 登录后修改密码
     ALTER USER 'root'@'localhost' IDENTIFIED BY 'jyg88891715';
     ```

   * ```mysql
     -- 开启远程访问
     use mysql;
     update user set host='%' where user='root';
     flush privileges; 
     exit;
     ```

8. 关闭防火墙

   * ```bash
     systemctl stop firewalld.service            #停止firewall        
     systemctl disable firewalld.service         #禁止firewall开机启动 
     ```

9. 配置成服务并开机启动

   * ```bash
     cp /usr/local/mysql/mysql8/support-files/mysql.server /etc/init.d/mysql
     chkconfig mysql on
     chkconfig --add mysql
     ```

   * ```bash
     # 配置后可用这样启动服务
     service mysql start
     service mysql stop
     ```

## reids

1. 解压

   * ```bash
     mkdir -p /usr/local/reids
     tar -zxvf redis-5.0.3.tar.gz -C /usr/local/reids
     ```

2. 编译

   * ```bash
     cd /usr/local/reids/redis-5.0.3
     ```

   * ```bash
     # 网络安装
     yumdownloader --resolve gcc-c++
     # 安装gcc
     sudo rpm -Uvh *.rpm
     
     make
     # 如果提示错误jemalloc/jemalloc.h: No such file or directory
     make MALLOC=libc
     ```

3. 在根目录（/usr/local/redis/redis-5.0.3）打开并修改配置文件 redis.conf

   * ```bash
     vim ./redis.conf
     ```

   * ```bash
     # 远程访问需要把bind注释掉
     bind 127.0.0.1 修改为 # bind 0.0.0.0
     
     # 默认启动时为后台启动
     daemonize yes
     
     protected-mode no
     
     # 设置密码，找到 # requirepass foobared 字符，在下面添加一行不加注视的：
     requirepass 需要设置的密码
     ```

4. 进入 src 文件夹以配置文件的形式启动项目

   * ```bash
     cd src
     ./redis-server ../redis.conf
     ```

5. 查看是否启动成功，如果有 6379 端口的服务代表启动成功

   * ```bash
     netstat -nlpt
     yum install net-tools
     ```

6. 测试连接

   * ```bash
     ./redis-cli
     # 进入客户端交互模式后输入
     auth 密码
     ```

## minio

1. 解压

   * ```bash
     mkdir -p /usr/local/minio
     
     mkdir -p /usr/local/minio/data
     ```

   * ```bash
     cp minio /usr/local/minio
     cd /usr/local/minio
     # 授权
     chmod +x minio
     ```

2. 启动服务

   * ```bash
     # 后台启动
     nohup ./minio server /data > miniolog 2>&1 &
     # 前台启动
     ./minio server /minio.log
     ```

3. 配置设置

   * ```bash
     ## 设置账号密码
     export MINIO_ACCESS_KEY=minioadmin
     export MINIO_SECRET_KEY=minioadmin
     
     # 设置数据存储路径
     export MINIO_DATA_DIR="/usr/local/minio/data/"
     
     ## 防火墙开启 9000 端口
     firewall-cmd --zone=public --add-port=9000/tcp --permanent
     
     ## 重启防火墙
     systemctl restart firewalld
     ```

4. 测试
   浏览器访问9000端口

## nginx

1. 解压

   * ```bash
     mkdir -p /usr/local/nginx
     
     tar -xzvf nginx-1.22.0.tar.gz -C /usr/local/nginx
     ```

2. 编译

   * ```bash
     cd /usr/local/nginx/nginx-1.22.0/
     ./configure && make && make install
     ```

   * ```bash
     # 如果编译错误
     ./configure: error: the HTTP gzip module requires the zlib library.
     You can either disable the module by using --without-http_gzip_module
     option, or install the zlib library into the system, or build the zlib library
     statically from the source with nginx by using --with-zlib=<path> option.
     # 安装必要依赖
     sudo rpm -Uvh *.rpm
     ```

3. 修改nginc.conf文件

   * ```bash
     
     #user  nobody;
     worker_processes  1;
     
     #error_log  logs/error.log;
     #error_log  logs/error.log  notice;
     #error_log  logs/error.log  info;
     
     #pid        logs/nginx.pid;
     
     
     events {
         worker_connections  1024;
     }
     
     
     http {
         include       mime.types;
         default_type  application/octet-stream;
         client_max_body_size 1024M; #上传文件大小限制
         sendfile on; #设置为on表示启动高效传输文件的模式
         keepalive_timeout 1800; #保持连接的时间，默认65s
         proxy_buffering off;
         #log_format  main  '$remote_addr - $remote_user [$time_local] "$request" '
         #                  '$status $body_bytes_sent "$http_referer" '
         #                  '"$http_user_agent" "$http_x_forwarded_for"';
     
         #access_log  logs/access.log  main;
     
         #sendfile        on;
         #tcp_nopush     on;
     
         #keepalive_timeout  0;
         #keepalive_timeout  65;
     
         #gzip  on;
     
         server {
             listen       80;
             server_name  localhost;
     
             #charset koi8-r;
     
             #access_log  logs/host.access.log  main;
     
             location / {
                 root   /data/biobank_ui;
                 index  index.html index.htm index;
     	try_files $uri $uri/ /index.html; #此处解决刷新页面出现404的问题
             }
     
     
             location ^~/biobank-store/ {
                proxy_pass http://127.0.0.1:8080/biobank-wf/;
                add_header Cache-Control no-cache;
             }
     
             #error_page  404              /404.html;
     
             # redirect server error pages to the static page /50x.html
             #
             error_page   500 502 503 504  /50x.html;
             location = /50x.html {
                 root   html;
             }
     
             # proxy the PHP scripts to Apache listening on 127.0.0.1:80
             #
             #location ~ \.php$ {
             #    proxy_pass   http://127.0.0.1;
             #}
     
             # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000
             #
             #location ~ \.php$ {
             #    root           html;
             #    fastcgi_pass   127.0.0.1:9000;
             #    fastcgi_index  index.php;
             #    fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;
             #    include        fastcgi_params;
             #}
     
             # deny access to .htaccess files, if Apache's document root
             # concurs with nginx's one
             #
             #location ~ /\.ht {
             #    deny  all;
             #}
         }
     
     
         # another virtual host using mix of IP-, name-, and port-based configuration
         #
         #server {
         #    listen       8000;
         #    listen       somename:8080;
         #    server_name  somename  alias  another.alias;
     
         #    location / {
         #        root   html;
         #        index  index.html index.htm;
         #    }
         #}
     
     
         # HTTPS server
         #
         #server {
         #    listen       443 ssl;
         #    server_name  localhost;
     
         #    ssl_certificate      cert.pem;
         #    ssl_certificate_key  cert.key;
     
         #    ssl_session_cache    shared:SSL:1m;
         #    ssl_session_timeout  5m;
     
         #    ssl_ciphers  HIGH:!aNULL:!MD5;
         #    ssl_prefer_server_ciphers  on;
     
         #    location / {
         #        root   html;
         #        index  index.html index.htm;
         #    }
         #}
     
     }
     
     ```

4. 启动和修改nginx.conf配置文件后平滑启动

   * ```bash
     whereis nginx # 查询nginx安装在哪里
     /usr/local/nginx/sbin/nginx # 启动
     /usr/local/nginx/sbin/nginx -s reload # 平滑重启
     ```

## tomcat

1. 解压

   * ```bash
     mkdir -p /usr/local/tomcat
     tar -zxvf apache-tomcat-8.5.61.tar.gz -C /usr/local
     ```

2. 启动

  ```bash
  cd /usr/local/apache-tomcat-8.5.61/bin/
  
  ./startup.sh
  ```

3. 将`.war`重命名为`biobank-wf`与nginx.conf一致

## 项目

1. MySQL注意配置groupby分组限制

   * ```bash
     # /etc/my.cnf
     sql_mode=STRICT_TRANS_TABLES,NO_ENGINE_SUBSTITUTION
     service mysqld restart
     ```

2. 配置导出pdf文件
